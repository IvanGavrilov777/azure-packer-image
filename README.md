# Azure packer image for Linux VM
Code for packer image which installs gnupg2, curl, tfswitch and jq.

## Prerequisites
* Azure access: CLIENT_ID, CLIENT_SECRET, SUBSCRIPTION_ID, TENANT_ID
* Azure resource group created in advance. 

## Distribution
Linux: Ubuntu server jammy 22_04-lts

## Input Variables
1. location
1. managed_image_name
1. managed_image_resource_group_name
1. vm_size

## Software provisioning
Provisioner is executing  following commands in sequence to install gnupg2, curl, tfswitch and jq packages:
```
apt update
apt upgrade -y
apt install -y software-properties-common gnupg2 curl
curl -L https://raw.githubusercontent.com/warrensbox/terraform-switcher/release/install.sh | bash
apt install -y jq
```
## Usage
* Clone the repo by using following command: `git clone https://github.com/IvanGavrilov777/azure-packer-image.git`
* Change directory: `cd azure-packer-image`
* Edit variables new values (optional): `nano azure-ubuntu.pkr.hcl`
* While file is still open fill your credential information instead of "***" for the values of:
```
  cliend_id = "***"
  client_secret = "***"
  subscription_id = "***"
  tenant_id = "***"
```
example: `cliend_id = "1111-2222-3333-4444"`

* Initialize the packer directory: `packer init .`
* Build packer image: `packer build azure-ubuntu.pkr.hcl`

## Result
If all the previous operations complete successfully you should receive report similar to the one below and to get your `ManagedImageID`:
```
==> Wait completed after 6 minutes 30 seconds

==> Builds finished. The artifacts of successful builds are:
--> azure-arm.autogenerated_1: Azure.ResourceManagement.VMImage:

OSType: Linux
ManagedImageResourceGroupName: IvanPackerResourceGroup
ManagedImageName: IvanPackerImage-UKsouth
ManagedImageId: /subscriptions/**************************/resourceGroups/IvanPackerResourceGroup/providers/Microsoft.Compute/images/IvanPackerImage-UKsouth
ManagedImageLocation: UK South
```
